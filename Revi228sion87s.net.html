<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Moderación - Bedrock Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00d4ff; --bg: #0a0b10; --card: rgba(255,255,255,0.05); }
        body { background: var(--bg); color: #fff; font-family: 'Poppins'; padding: 20px; }
        h2 { font-family: 'Orbitron'; text-align: center; color: var(--accent); text-transform: uppercase; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .mod-card { background: var(--card); border: 1px solid rgba(0,212,255,0.2); padding: 15px; border-radius: 15px; transition: 0.3s; }
        .mod-card:hover { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,212,255,0.1); }
        .mod-card img { width: 100%; border-radius: 10px; height: 160px; object-fit: cover; background: #000; }
        .card-info { margin-top: 10px; }
        .card-info h3 { margin: 5px 0; font-size: 1.1rem; color: var(--accent); }
        .card-info p { font-size: 0.8rem; color: #bbb; margin: 2px 0; }
        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Orbitron'; font-size: 0.7rem; font-weight: bold; transition: 0.2s; }
        .btn-approve { background: #2ecc71; color: #000; }
        .btn-approve:hover { background: #27ae60; }
        .btn-reject { background: #e74c3c; color: #fff; }
        .btn-reject:hover { background: #c0392b; }
        #empty-msg { text-align: center; grid-column: 1/-1; padding: 50px; color: #555; font-family: 'Orbitron'; }
    </style>
</head>
<body>
    <h2><i class="fas fa-shield-alt"></i> Solicitudes en Revisión</h2>
    <div id="mod-grid" class="grid">Cargando solicitudes...</div>

    <script>
        const sheetId = '1VVO_fKNZqPdeCDagWF8s7clq7uMZfCY3-HDTksAmNnw';
        // ASEGÚRATE QUE ESTA URL SEA LA DE TU ÚLTIMA IMPLEMENTACIÓN
        const scriptURL = "https://script.google.com/macros/s/AKfycbyxezM7lhtD7lmpqg_ww8X3afZ_VEUTH56klo55skV9CJ-0XlW63hAUvyyTyYGWUr8mdQ/exec";

        async function cargarPendientes() {
            const grid = document.getElementById('mod-grid');
            try {
                // CAMBIO CLAVE: "revision" en lugar de "Pendientes"
                const res = await fetch(`https://opensheet.elk.sh/${sheetId}/revision`);
                const data = await res.json();
                
                grid.innerHTML = '';

                if (!data || data.length === 0) {
                    grid.innerHTML = '<div id="empty-msg">NO HAY CONTENIDO PENDIENTE</div>';
                    return;
                }

                data.forEach(item => {
                    const v = Object.values(item);
                    // Mapeo según tu imagen: 0:Fecha, 1:Nombre, 2:Link, 3:Imagen, 4:Categoría
                    const nombre = v[1];
                    const imagen = v[3] || "https://via.placeholder.com/300x160?text=Sin+Imagen";
                    const categoria = v[4];

                    grid.innerHTML += `
                        <div class="mod-card" id="card-${btoa(nombre).replace(/=/g, "")}">
                            <img src="${imagen}" onerror="this.src='https://via.placeholder.com/300x160?text=Error+Imagen'">
                            <div class="card-info">
                                <h3>${nombre}</h3>
                                <p><i class="fas fa-tag"></i> ${categoria}</p>
                                <p><i class="fas fa-clock"></i> ${v[0]}</p>
                            </div>
                            <div class="actions">
                                <button class="btn btn-approve" onclick="moderar('${nombre}', 'approve')">APROBAR</button>
                                <button class="btn btn-reject" onclick="moderar('${nombre}', 'reject')">RECHAZAR</button>
                            </div>
                        </div>`;
                });
            } catch (error) {
                grid.innerHTML = '<p style="text-align:center; color:red;">Error al cargar: ' + error.message + '</p>';
            }
        }

        async function moderar(nombre, accion) {
            if(!confirm(`¿Deseas ${accion === 'approve' ? 'Aprobar e instalar' : 'Eliminar definitivamente'} a "${nombre}"?`)) return;
            
            // Efecto visual de carga
            const cardId = `card-${btoa(nombre).replace(/=/g, "")}`;
            const card = document.getElementById(cardId);
            if(card) card.style.opacity = "0.3";

            try {
                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ action: accion, nombre: nombre })
                });

                alert("Acción procesada correctamente");
                cargarPendientes(); // Recargar la lista
            } catch (e) {
                alert("Error al procesar: " + e.message);
                if(card) card.style.opacity = "1";
            }
        }

        cargarPendientes();
    </script>
</body>
</html>
