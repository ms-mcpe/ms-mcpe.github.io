<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MC Creator Studio | Pro Console</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Outfit:wght@300;500;800&display=swap" rel="stylesheet">

    <style>
        /* --- VARIABLES --- */
        :root {
            --primary: #FFD700;
            --primary-glow: rgba(255, 215, 0, 0.3);
            --bg-dark: #050505;
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #ffffff;
            --radius: 12px;
        }

        /* --- RESET Y SEGURIDAD VISUAL --- */
        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Bloqueo de selección SOLO en el cuerpo, no global */
        body {
            margin: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a1a00 0%, var(--bg-dark) 60%);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
            height: 100vh;
            user-select: none; /* Anti-Selección general */
            -webkit-user-select: none;
            -webkit-user-drag: none;
        }

        /* --- CORRECCIÓN CRÍTICA DE INPUTS (TEXTO INVISIBLE) --- */
        input, textarea, select {
            user-select: text !important;
            -webkit-user-select: text !important;
            pointer-events: auto !important;
            
            /* Fuerza el color del texto */
            color: #ffffff !important;
            -webkit-text-fill-color: #ffffff !important; 
            
            /* Fondo sólido oscuro para evitar mezclas */
            background-color: #1a1a1a !important; 
            border: 1px solid #444 !important;
            
            opacity: 1 !important;
            z-index: 9999 !important; /* Siempre encima */
        }

        /* Fix para Autocompletado de Google/Android (Evita fondo blanco/texto blanco) */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #1a1a1a inset !important;
            -webkit-text-fill-color: white !important;
            transition: background-color 5000s ease-in-out 0s;
        }

        /* Placeholder color */
        ::placeholder { color: rgba(255, 255, 255, 0.5) !important; opacity: 1; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        /* --- SIDEBAR --- */
        .sidebar {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 260px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 2000;
            display: flex; flex-direction: column;
        }
        .sidebar.active { transform: translateX(0); }
        
        .sidebar-header { padding: 30px; text-align: center; border-bottom: 1px solid var(--glass-border); }
        .brand-logo { font-size: 1.8rem; color: var(--primary); text-shadow: 0 0 15px var(--primary-glow); font-family: 'Rajdhani', sans-serif; font-weight: bold; }
        
        .nav-menu { list-style: none; padding: 20px; flex-grow: 1; }
        .nav-item {
            display: flex; align-items: center; gap: 15px;
            padding: 15px; margin-bottom: 8px; color: #888;
            text-decoration: none; border-radius: var(--radius); transition: 0.3s;
        }
        .nav-item:hover, .nav-item.active { background: rgba(255, 215, 0, 0.1); color: var(--primary); }

        /* --- HEADER --- */
        .top-bar {
            position: fixed; top: 0; left: 0; right: 0;
            height: 70px;
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }
        .menu-toggle { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }

        /* --- CONTENIDO --- */
        .main-container {
            margin-top: 70px; padding: 20px;
            max-width: 1400px; margin-left: auto; margin-right: auto;
            opacity: 0; transform: translateY(20px);
            animation: fadeInPage 0.6s forwards 0.2s;
        }
        @keyframes fadeInPage { to { opacity: 1; transform: translateY(0); } }

        /* --- CARDS --- */
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card {
            background: #121212; border: 1px solid var(--glass-border);
            border-radius: var(--radius); overflow: hidden; position: relative; transition: 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-img { width: 100%; height: 160px; object-fit: cover; filter: brightness(0.8); pointer-events: none; }
        .card-body { padding: 15px; }
        .card-title { margin: 0 0 5px; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-meta { font-size: 0.8rem; color: #666; display: flex; justify-content: space-between; }
        
        .card-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 8px; z-index: 5; }
        .action-btn { width: 32px; height: 32px; border-radius: 8px; border: none; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; }
        .btn-edit { background: rgba(0, 150, 255, 0.8); }
        .btn-del { background: rgba(255, 71, 87, 0.8); }

        /* --- INPUTS ESTILO --- */
        .cyber-input {
            width: 100%; 
            padding: 15px;
            border-radius: 8px; 
            margin-bottom: 15px;
            font-family: 'Outfit', sans-serif; 
            transition: 0.3s;
            position: relative;
        }
        .cyber-input:focus { border-color: var(--primary) !important; box-shadow: 0 0 10px rgba(255,215,0,0.1); }

        .cyber-btn {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, var(--primary), #e6c200);
            border: none; border-radius: 8px; color: #000; font-weight: bold;
            text-transform: uppercase; cursor: pointer; transition: 0.3s;
            font-family: 'Rajdhani', sans-serif; letter-spacing: 1px;
        }
        .cyber-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--primary-glow); }

        /* --- MODALES --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px); z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }

        .modal-box {
            background: #0a0a0a; border: 1px solid var(--primary);
            width: 90%; max-width: 450px; padding: 30px; border-radius: 20px;
            text-align: center; transform: scale(0.9); transition: 0.3s;
            box-shadow: 0 0 30px rgba(255,215,0,0.1);
        }
        .modal-overlay.active .modal-box { transform: scale(1); }

        /* Botón Flotante */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px; background: var(--primary);
            color: #000; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 1.5rem; border: none; z-index: 100;
            box-shadow: 0 0 20px var(--primary-glow); cursor: pointer;
        }

        .section { display: none; }
        .section.active { display: block; }
        
        .control-bar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 20px; border-bottom: 1px solid var(--glass-border); }
        .filter-btn { background: transparent; border: 1px solid #333; color: #888; padding: 8px 20px; border-radius: 50px; white-space: nowrap; cursor: pointer; }
        .filter-btn.active { background: var(--primary); color: #000; }
        
        /* Loader */
        #page-loader { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .spinner { width: 50px; height: 50px; border: 3px solid rgba(255,215,0,0.3); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body oncontextmenu="return false;">

    <div id="page-loader"><div class="spinner"></div></div>

    <div class="modal-overlay active" id="auth-overlay">
        <div class="modal-box">
            <h2 class="brand-logo" style="margin-bottom: 20px;">MC CREATOR HUB</h2>
            <h3 id="auth-title" style="color:white; margin-bottom:20px;">Acceso Restringido</h3>
            
            <input type="text" id="user-in" class="cyber-input" placeholder="Usuario">
            <input type="password" id="pass-in" class="cyber-input" placeholder="Contraseña">
            
            <button class="cyber-btn" id="btn-login" onclick="handleAuth()">INGRESAR AL SISTEMA</button>
            
            <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                <span id="switch-txt" onclick="toggleAuthMode()" style="color:var(--primary); cursor:pointer; border-bottom:1px solid var(--primary);">
                    ¿No tienes cuenta? Regístrate
                </span>
            </p>
        </div>
    </div>

    <div class="modal-overlay" id="edit-overlay">
        <div class="modal-box">
            <h3 style="color:var(--primary);">Editar Recurso</h3>
            <input type="hidden" id="edit-orig-name">
            <input type="text" id="edit-name" class="cyber-input" placeholder="Nombre">
            <input type="text" id="edit-url" class="cyber-input" placeholder="URL (Link directo)">
            <label style="display:block; text-align:left; color:#888; margin-bottom:5px; font-size:0.8rem;">Actualizar Imagen (Opcional)</label>
            <input type="file" id="edit-img" class="cyber-input" style="padding:10px;">
            
            <div style="display:flex; gap:10px;">
                <button class="cyber-btn" onclick="saveEdit()" id="btn-save-edit">GUARDAR</button>
                <button class="cyber-btn" style="background:#333; color:white;" onclick="closeModal('edit-overlay')">CANCELAR</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="sidebar-overlay" onclick="toggleSidebar()" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1900; display:none;"></div>
    
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="brand-logo"><i class="fas fa-cube"></i> MC HUB</div>
            <div style="font-size:0.8rem; color:#555; margin-top:5px;">Professional Edition</div>
        </div>
        <ul class="nav-menu">
            <li><a href="#" class="nav-item active" onclick="navTo('home')"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="#" class="nav-item" onclick="navTo('upload')"><i class="fas fa-cloud-upload-alt"></i> Subir</a></li>
            <li style="margin-top:auto; border-top:1px solid #222;">
                <a href="#" class="nav-item" onclick="logout()" style="color:#ff4757;"><i class="fas fa-power-off"></i> Cerrar Sesión</a>
            </li>
        </ul>
    </nav>

    <header class="top-bar">
        <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        <div style="color:white; font-family:'Rajdhani'; font-weight:700;">PANEL DE CONTROL</div>
        <div style="width:30px;"></div>
    </header>

    <main class="main-container">
        
        <section id="home" class="section active">
            <div class="control-bar">
                <button class="filter-btn active" onclick="filterMode(null, this)">Explorar Todo</button>
                <button class="filter-btn" onclick="filterMode('edit', this)">Editar Mis Archivos</button>
                <button class="filter-btn" onclick="filterMode('delete', this)">Eliminar Mis Archivos</button>
            </div>
            
            <div id="content-grid" class="grid-layout">
                </div>
        </section>

        <section id="upload" class="section">
            <div style="max-width:600px; margin:0 auto; background:#111; padding:30px; border-radius:20px; border:1px solid #333;">
                <h2 style="text-align:center; color:var(--primary); margin-bottom:30px;">Publicar Nuevo Addon</h2>
                
                <input type="text" id="up-name" class="cyber-input" placeholder="Nombre del Addon / Mapa">
                
                <select id="up-cat" class="cyber-input" style="background:#1a1a1a;">
                    <option value="Add-On">Add-On (Mod)</option>
                    <option value="Mapa">Mapa / Mundo</option>
                    <option value="Texture">Textura / Shaders</option>
                    <option value="Skin">Skin Pack</option>
                    <option value="Semilla">Semilla (Seed)</option>
                    <option value="version">Minecraft</option>
                </select>

                <input type="text" id="up-link" class="cyber-input" placeholder="Enlace de Descarga (Cuty.io)">
                
                <label style="display:block; text-align:left; color:#888; margin-bottom:5px; font-size:0.8rem;">Imagen de Portada</label>
                <input type="file" id="up-img" class="cyber-input" accept="image/*" style="padding:10px;">
                
                <button class="cyber-btn" id="btn-upload" onclick="uploadContent()">PUBLICAR AHORA</button>
                <button class="cyber-btn" style="background:transparent; border:1px solid #333; color:#888; margin-top:10px;" onclick="navTo('home')">CANCELAR</button>
            </div>
        </section>

    </main>



    <script>
        // --- SEGURIDAD AJUSTADA ---
        (function() {
            // Bloqueo de Teclas de Inspector
            document.onkeydown = function(e) {
                if(e.keyCode == 123) return false; // F12
                if(e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) return false; 
                if(e.ctrlKey && e.keyCode == 85) return false; 
            }

            // Trampa de Debugger (Solo se activa si abren la consola)
            setInterval(function(){
                if(window.outerWidth - window.innerWidth > 100 || window.outerHeight - window.innerHeight > 100) {
                   document.body.innerHTML = "<h1 style='color:red;text-align:center;margin-top:20%'>SEGURIDAD ACTIVADA<br>Cierra el inspector.</h1>";
                }
            }, 1000);
        })();

        // --- LÓGICA DE LA APP ---
        const API_URL = "https://script.google.com/macros/s/AKfycbyxezM7lhtD7lmpqg_ww8X3afZ_VEUTH56klo55skV9CJ-0XlW63hAUvyyTyYGWUr8mdQ/exec";
        let user = localStorage.getItem('mc_pro_user');
        let isRegister = false;
        let currentMode = null; 

        window.onload = () => {
            const loader = document.getElementById('page-loader');
            if(user) {
                document.getElementById('auth-overlay').classList.remove('active');
                loadData();
                setTimeout(() => loader.style.opacity = 0, 500);
                setTimeout(() => loader.style.display = 'none', 1000);
            } else {
                loader.style.display = 'none';
            }
        };

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('sidebar-overlay');
            sb.classList.toggle('active');
            ov.style.display = sb.classList.contains('active') ? 'block' : 'none';
        }

        function toggleAuthMode() {
            isRegister = !isRegister;
            document.getElementById('auth-title').innerText = isRegister ? "Crear Nueva Cuenta" : "Acceso Restringido";
            document.getElementById('btn-login').innerText = isRegister ? "REGISTRARME" : "INGRESAR AL SISTEMA";
            document.getElementById('switch-txt').innerText = isRegister ? "¿Ya tienes cuenta? Ingresa aquí" : "¿No tienes cuenta? Regístrate";
            if(isRegister) {
                if(confirm("INFORMACIÓN:\n\nRegístrate con tu correo real. Si Google falla, usa el formulario manual.")) {
                    window.open("https://cuty.io/ref/myststart", "_blank");
                }
            }
        }

        async function handleAuth() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            const btn = document.getElementById('btn-login');
            
            if(!u || !p) return alert("Faltan datos");
            btn.innerText = "PROCESANDO..."; btn.disabled = true;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST', body: JSON.stringify({ action: isRegister ? "register" : "login", user: u, pass: p })
                });
                const txt = await res.text();
                
                if(txt.includes("OK")) {
                    localStorage.setItem('mc_pro_user', u);
                    location.reload();
                } else {
                    alert("Error: " + txt);
                    btn.disabled = false; btn.innerText = "REINTENTAR";
                }
            } catch(e) { alert("Error de conexión"); btn.disabled = false; }
        }

        function logout() { localStorage.removeItem('mc_pro_user'); location.reload(); }

        function navTo(pageId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // Cerrar sidebar
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebar-overlay').style.display = 'none';
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(event && event.currentTarget) event.currentTarget.classList.add('active');
        }

        async function loadData() {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '<div style="color:var(--primary); padding:20px;">Cargando base de datos segura...</div>';
            
            try {
                const res = await fetch(API_URL + "?action=read");
                const data = await res.json();
                grid.innerHTML = '';
                
                data.reverse().forEach(item => {
                    const [fecha, nombre, link, img, cat, likes, dl, seed, autor] = item;
                    if(currentMode && autor !== user) return;

                    const div = document.createElement('div');
                    div.className = 'card';
                    let btns = '';
                    if(currentMode === 'edit') btns = `<button class="action-btn btn-edit" onclick="openEdit('${nombre}','${link}')"><i class="fas fa-pen"></i></button>`;
                    if(currentMode === 'delete') btns = `<button class="action-btn btn-del" onclick="deleteItem('${nombre}')"><i class="fas fa-trash"></i></button>`;
                    
                    div.innerHTML = `<img src="${img}" class="card-img" loading="lazy">
                        ${btns ? `<div class="card-actions">${btns}</div>` : ''}
                        <div class="card-body"><span style="font-size:0.7rem; color:var(--primary); text-transform:uppercase;">${cat}</span>
                        <h3 class="card-title">${nombre}</h3>
                        <div class="card-meta"><span><i class="fas fa-user"></i> ${autor}</span><span><i class="fas fa-heart"></i> ${likes || 0}</span></div></div>`;
                    grid.appendChild(div);
                });
            } catch(e) { grid.innerHTML = '<p style="color:red">Error cargando datos.</p>'; }
        }

        function filterMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadData();
        }

        async function uploadContent() {
            const url = document.getElementById('up-link').value;
            if(!url.toLowerCase().includes("cuty")) return alert("Enlace inválido.");
            
            const btn = document.getElementById('btn-upload');
            btn.innerText = "SUBIENDO..."; btn.disabled = true;

            const file = document.getElementById('up-img').files[0];
            const base64 = await toBase64(file);

            const payload = {
                action: "add", nombre: document.getElementById('up-name').value,
                category: document.getElementById('up-cat').value,
                link: url, subidoPor: user, img: base64
            };
            sendData(payload, btn);
        }

        async function saveEdit() {
            const url = document.getElementById('edit-url').value;
            if(!url.toLowerCase().includes("cuty")) return alert("Enlace inválido.");
            
            const btn = document.getElementById('btn-save-edit');
            btn.innerText = "..."; btn.disabled = true;

            const payload = {
                action: "edit", nombreOriginal: document.getElementById('edit-orig-name').value,
                nuevoNombre: document.getElementById('edit-name').value,
                nuevaUrl: url, usuario: user
            };
            const file = document.getElementById('edit-img').files[0];
            if(file) payload.nuevaImg = await toBase64(file);
            sendData(payload, btn);
        }

        async function deleteItem(nombre) {
            if(!confirm("¿Eliminar?")) return;
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: "delete", nombre, usuario: user }) });
            loadData();
        }

        async function sendData(payload, btn) {
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                alert("Éxito"); location.reload();
            } catch(e) { alert("Error"); btn.disabled = false; }
        }

        function openEdit(nombre, link) {
            document.getElementById('edit-orig-name').value = nombre;
            document.getElementById('edit-name').value = nombre;
            document.getElementById('edit-url').value = link;
            document.getElementById('edit-overlay').classList.add('active');
        }

        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    </script>
</body>
</html>
